# Disable any shell actions, replace them with simply 'true'
%define __spec_prep_post true
%define __spec_prep_pre true
%define __spec_build_post true
%define __spec_build_pre true
%define __spec_install_post true
%define __spec_install_pre true
%define __spec_clean_post true
%define __spec_clean_pre true

# Setup payload compression
<% if compression_threads != 1 && compression_algo == "xzdio" %>
%define _binary_payload w<%= compression_level %>T<%= compression_threads %>.xzdio
<% else %>
%define _binary_payload w<%= compression_level %>.<%= compression_algo %>
<% end %>

# Disable creation of build-id links
%define _build_id_links none

# Metadata
Name: <%= name %>
Version: <%= version %>
<% unless epoch.empty? -%>
Epoch: <%= epoch %>
<% end -%>
Release: <%= iteration %><%= dist_tag ? dist_tag : '' %>
Summary:  <%= description.split("\n").first.empty? ? "_" : description.split("\n").first %>
AutoReqProv: no
BuildRoot: %buildroot
Prefix: /
Group: <%= category %>
License: <%= license %>
Vendor: <%= vendor %>
URL: <%= homepage %>
Packager: <%= maintainer %>
<% dependencies.each do |name| -%>
Requires: <%= name %>
<% end -%>
<% script_dependencies.each do |script, script_deps_list| -%>
<% script_deps_list.each do |name| -%>
Requires(<%= script %>): <%= name %>
<% end -%>
<% end -%>
<% conflicts.each do |name| -%>
Conflicts: <%= name %>
<% end -%>
<% replaces.each do |name| -%>
Obsoletes: <%= name %>
<%- end -%>
<% # RPM rejects descriptions with blank lines (even between content) -%>
%description
<%= description.gsub(/^\s*$/, " .") %>

%prep
# noop

%build
# noop

%install
# noop

%clean
# noop

<% scripts.each do |name, contents| -%>
%<%= name %>
<%= contents %>
<% end -%>

%files
%defattr(-,<%= user %>,<%= group %>,-)
<% # Output config files and then regular files -%>
<% config_files.each do |file| -%>
%config(noreplace) <%= file %>
<% end -%>
<% # List all files -%>
<% files.each do |file| -%>
<%= file %>
<% end -%>
